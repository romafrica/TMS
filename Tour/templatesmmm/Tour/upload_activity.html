{% extends 'base.html' %}
{% block content %}
<div class="container my-5">
  <h2 class="mb-4">Add Activity / Service for <strong>{{ destination.name }}</strong></h2>

  <form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-success">Save Activity</button>
    <a href="{% url 'destination_detail' destination.id %}" class="btn btn-secondary ms-2">Cancel</a>
  </form>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const dateInput = document.getElementById("dateInput");
    const destinationId = document.getElementById("destinationSelect").value;

    fetch(`/api/valid-dates/${destinationId}/`)
        .then(response => response.json())
        .then(data => {
            const allowedDates = data.valid_dates;

            if (allowedDates.length) {
                dateInput.setAttribute("min", allowedDates[0]);
                dateInput.setAttribute("max", allowedDates[allowedDates.length - 1]);
            }

            dateInput.addEventListener("input", function () {
                if (!allowedDates.includes(this.value)) {
                    alert("Selected date is not within allowed travel dates for this destination.");
                    this.value = "";
                }
            });
        });
});
</script>
{% endblock %}
